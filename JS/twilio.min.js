Twilio={extend:function(u){for(var P in u)Twilio[P]=u[P]}};
Twilio.extend(function(){var u={},P={},Q,oa=function(a){if(!(a in P)){var b={};u["lib/"+a+".js"].apply(b,[oa,b]);P[a]=b}return P[a]};Q=oa;u["lib/twilio/connection.js"]=function(a,b){function c(a,b,g){if(!(this instanceof c))return new c(b,g);this.device=a;this.message=b||{};g=g||{};a={logPrefix:"[Connection]",bridgeToken:null,mediaStreamFactory:l.enabled()?d.PeerConnection:d.MediaStream,chunder:"chunder.prod.twilio.com",chunderw:"chunderw.prod.twilio.com",debug:!1,encrypt:!1,token:null};for(var e in a)e in
g||(g[e]=a[e]);this.options=g;this.parameters={};this._status=this.options.bridgeToken?"pending":"closed";p.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;f.mixinEventEmitter(this);this.mediaStream=this.options.mediaStreamFactory(this.options.encrypt,this.options[l.enabled()?"chunderw":"chunder"],this.device.options.simpleDialog);var n=this;this.mediaStream.onerror=function(a){var b={code:a.info.code,message:a.info.message,info:a.info};n.log("Received an error from MediaStream:",
a);n.fire("error",b)};this.mediaStream.onopen=function(){n._status="open";n.mediaStream.publish("input","live");n.mediaStream.attachAudio();n.mediaStream.play("output");n.fire("accept",n)};this.mediaStream.onclose=function(){n._status="closed";n.device.sounds.disconnect()&&n.device.soundcache.play("disconnect");n.fire("disconnect",n)}}var d=a("twilio/factories"),f=a("twilio/eventemitter"),p=a("twilio/log"),g=a("twilio/util"),l=a("twilio/rtc");c.toString=function(){return"[Twilio.Connection class]"};
c.prototype={toString:function(){return"[Twilio.Connection instance]"},sendDigits:function(a){if(a.match(/[^0-9*#w]/))throw new g.Exception("Illegal character passed into sendDigits");this.mediaStream.exec("sendDTMF",a);for(var b=[],c=0;c<a.length;c++){var d="w"!=a[c]?"dtmf"+a[c]:"";"dtmf*"==d&&(d="dtmfs");"dtmf#"==d&&(d="dtmfh");b.push([d,200,20])}this.device.soundcache.playseq(b)},status:function(){return this._status},mute:function(){this.mediaStream.detachAudio()},unmute:function(){this.mediaStream.attachAudio()},
accept:function(a){if("function"==typeof a)return this.addListener("accept",a);var b=this;d.getClass("vendor/mediastream/mediastream","MediaStream");this._status="pending";this.mediaStream.openHelper(function(a){if(a)b._die(a);else{a=[];for(var c in b.message)a.push(c+"="+encodeURIComponent(b.message[c]));c=[b.mediaStream.uri(),b.options.token,b.options.bridgeToken,a.join("&")].concat(b.options.acceptParams);b.mediaStream.open.apply(b.mediaStream,c)}},this.device.options.simpleDialog,c.NO_MIC_LEVEL||
0,function(){ca.dialog.show()},function(a){b.device.showSettings(a)})},reject:function(a){if("function"==typeof a)return this.addListener("reject",a);this.device.stream.publish({Response:"reject",CallSid:this.parameters.CallSid},this.options.rejectChannel);this.fire("reject")},ignore:function(a){if("function"==typeof a)return this.addListener("cancel",a);this._status="closed";this.fire("cancel")},cancel:function(a){this.ignore(a)},disconnect:function(a){if("function"==typeof a)return this.addListener("disconnect",
a);"open"==this._status&&(this.log("Disconnecting..."),this.mediaStream.close())},error:function(a){if("function"==typeof a)return this.addListener("error",a)},_die:function(a){this.fire("error",{message:a})}};b.Connection=c};u["lib/twilio/device.js"]=function(a,b){function c(b,d){if(!(this instanceof c))return new c(b,d);if(!b)throw new l.Exception("Capability token is not valid or missing.");var r={logPrefix:"[Device]",host:"chunder.twilio.com",chunderw:"chunderw.twilio.com",soundCacheFactory:f.SoundCache,
soundFactory:f.Sound,connectionFactory:f.Connection,eventStreamFactory:f.EventStream,presenceFactory:f.Presence,eventsScheme:"wss",eventsHost:"matrix.twilio.com",noRegister:!1,encrypt:!1,simpleDialog:!1,rtc:!0,debug:!1,confirmOnClose:!1};d=d||{};for(var h in r)h in d||(d[h]=r[h]);this.options=d;this.token=b;this._status="offline";this.connections=[];this.sounds=new m({incoming:!0,outgoing:!0,disconnect:!0});this.options.rtc||a("twilio/rtc").enabled(!1);this.soundcache=this.options.soundCacheFactory();
r={incoming:"sounds/incoming.mp3",outgoing:"sounds/outgoing.mp3",disconnect:"sounds/disconnect.mp3",dtmf1:"sounds/dtmf-1.mp3",dtmf2:"sounds/dtmf-2.mp3",dtmf3:"sounds/dtmf-3.mp3",dtmf4:"sounds/dtmf-4.mp3",dtmf5:"sounds/dtmf-5.mp3",dtmf6:"sounds/dtmf-6.mp3",dtmf7:"sounds/dtmf-7.mp3",dtmf8:"sounds/dtmf-8.mp3",dtmf9:"sounds/dtmf-9.mp3",dtmf0:"sounds/dtmf-0.mp3",dtmfs:"sounds/dtmf-star.mp3",dtmfh:"sounds/dtmf-hash.mp3"};h="undefined"===typeof M?"":M;for(var n in r){var R=this.options.soundFactory();R.load(h+
r[n]);this.soundcache.add(n,R)}this.soundcache.envelope("incoming",{release:2E3});g.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;p.mixinEventEmitter(this);var e=this;this.addListener("incoming",function(a){a.addListener("accept",function(){e.soundcache.stop("incoming")});a.addListener("cancel",function(){e.soundcache.stop("incoming")});e.sounds.incoming()&&e.soundcache.play("incoming",0,1E3)});this.register(this.token);this.options.confirmOnClose&&window.addEventListener("beforeunload",
function(a){if("busy"==e._status)return(a||window.event).returnValue="A call is currently active."})}function d(a,b,c,d,f){var g={acceptParams:[JSON.stringify(l.getSystemInfo()),l.objectize(a.token).iss],chunder:a.options.host,chunderw:a.options.chunderw,encrypt:a.options.encrypt,debug:a.options.debug};f=f||{};for(var p in g)p in f||(f[p]=g[p]);"bridge"==c?(f.bridgeToken=b,f.token=null):"jwt"==c?(f.bridgeToken=null,f.token=b):this.log("Unknown token type: "+c);var r=a.options.connectionFactory(a,
d,f);r.addListener("accept",function(){a._status="busy";a.fire("connect",r)});r.addListener("error",function(b){a.fire("error",b);if("pending"==r.status()){b=[].concat(a.connections);for(var c=0;c<b.length;c++)r==b[c]&&a.connections.splice(c,1)}});r.addListener("cancel",function(){a.log("Canceled: "+r.parameters.CallSid);for(var b=[].concat(a.connections),c=0;c<b.length;c++)r==b[c]&&a.connections.splice(c,1);a.fire("cancel",r)});r.addListener("disconnect",function(){"busy"==a._status&&(a._status=
"ready");a.fire("disconnect",r);for(var b=[].concat(a.connections),c=0;c<b.length;c++)r==b[c]&&a.connections.splice(c,1)});return r}var f=a("twilio/factories"),p=a("twilio/eventemitter"),g=a("twilio/log"),l=a("twilio/util"),m=a("twilio/options").Options;a("twilio/dialog");c.toString=function(){return"[Twilio.Device class]"};c.prototype={toString:function(){return"[Twilio.Device instance]"},register:function(a){var b;b=this.options.eventsScheme;var c=this.options.eventsHost;b="client:incoming"in l.objectize(a).scope?
[b+"://"+c,"2012-02-09",l.objectize(a).iss,l.objectize(a).scope["client:incoming"].params.clientName].join("/")+"?"+["AccessToken="+a,"feature=incomingCalls&feature=publishPresence&feature=presenceEvents"].join("&"):null;var f=this;!b||this.options.noRegister?(this.stream&&(this.stream.destroy(),this.presenceClient&&this.presenceClient.detach(this.stream),this.stream=null),this.log("Unable to receive incoming calls"),"offline"==f._status&&(f._status="ready"),setTimeout(function(){f.fire("ready",f)},
0)):this.stream?(this.stream.options.url=b,this.stream.reconnect(a)):(this.log("Registering to stream with url: "+b),this.stream=this.options.eventStreamFactory(a,{logPrefix:"[Matrix]",debug:this.options.debug,url:b}),this.stream.addListener("ready",function(){f.log("Stream is ready");"offline"==f._status&&(f._status="ready");f.fire("ready",f)}),this.stream.addListener("offline",function(){f.log("Stream is offline");f._status="offline";f.fire("offline",f)}),this.stream.addListener("error",function(a){f.log("Received error: ",
a);f.fire("error",a)}),this.stream.addListener("incoming",function(a){f.log("Message incoming...",a);switch(a.Request){case "invite":if("busy"==f._status){f.log("Device busy; ignoring incoming invite");break}if(!a.Token||!a.CallSid){f.fire("error",{message:"Malformed invite"});break}var b=a.Parameters||{};a=d(f,a.Token,"bridge",{},{rejectChannel:a.RejectChannel});a.parameters=b;f.connections.push(a);f.fire("incoming",a);break;case "cancel":for(var b=[].concat(f.connections),c=0;c<b.length;c++){var l=
b[c];l.parameters.CallSid==a.CallSid&&"pending"==l.status()&&l.cancel()}}}),a=l.objectize(a).scope["client:incoming"].params.clientName,this.presenceClient=this.options.presenceFactory(a,this,this.stream,{autoStart:!0}))},presence:function(a){"client:incoming"in l.objectize(this.token).scope&&this.presenceClient.handlers.push(a)},showSettings:function(a){c.dialog.show(a);f.getClass("vendor/mediastream/mediastream","MediaStream").showSettings();c.dialog.screen.style.width="200%"},connect:function(a){if("function"==
typeof a)return this.addListener("connect",a);a=a||{};a=d(this,this.token,"jwt",a);this.connections.push(a);if(this.sounds.outgoing()){var b=this;a.accept(function(){b.soundcache.play("outgoing")})}a.accept();return a},disconnectAll:function(a){if("function"==typeof a)return this.addListener("disconnectAll",a);a=[].concat(this.connections);for(var b=0;b<a.length;b++)a[b].disconnect();0<this.connections.length&&this.log("Connections left pending: "+this.connections.length)},destroy:function(){this.stream.destroy();
this.swf&&this.swf.disconnect&&this.swf.disconnect()},disconnect:function(a){this.addListener("disconnect",a)},incoming:function(a){this.addListener("incoming",a)},offline:function(a){this.addListener("offline",a)},ready:function(a){this.addListener("ready",a)},error:function(a){this.addListener("error",a)},status:function(){return this._status}};var h=c,e=[],y=[],n=function(a){if(h.instance)return a();y.push(a)},B=function(a){a=(a.code?a.code+": ":"")+a.message;h.instance&&h.instance.log(a);throw new l.Exception(a);
},r={instance:null,setup:function(a,b){if(h.instance)h.instance.log("Found existing Device; using new token but ignoring options"),h.instance.token=a,h.instance.register(a);else{h.instance=new c(a,b);h.sounds=h.instance.sounds;for(var f=0;f<y.length;f++)y[f]();h.error(B)}for(f=0;f<e.length;f++)e[f](a,b);e=[];return h},connect:function(a){if("function"==typeof a)n(function(){h.instance.addListener("connect",a)});else{if(!h.instance)throw new l.Exception("Run Twilio.Device.setup()");if(0<h.instance.connections.length)h.instance.fire("error",
{message:"A connection is currently active"});else return h.instance.connect(a)}},disconnectAll:function(){n(function(){h.instance.disconnectAll()});return h},disconnect:function(a){n(function(){h.instance.addListener("disconnect",a)});return h},status:function(){return h.instance._status},ready:function(a){n(function(){h.instance.addListener("ready",a)});return h},error:function(a){n(function(){a!=B&&h.instance.removeListener("error",B);h.instance.addListener("error",a)});return h},presence:function(a){n(function(){h.instance.presence(a)});
return h},offline:function(a){n(function(){h.instance.addListener("offline",a)});return h},incoming:function(a){n(function(){h.instance.addListener("incoming",a)});return h},destroy:function(){h.instance&&h.instance.destroy();return h},cancel:function(a){n(function(){h.instance.addListener("cancel",a)});return h},showPermissionsDialog:function(){if(!h.instance)throw new l.Exception("Run Twilio.Device.setup()");h.instance.showSettings()},__afterSetup:function(a){e.push(a)}},R;for(R in r)h[R]=r[R];
c=h;c.dialog=f.Dialog();b.Device=c};u["lib/twilio/dialog.js"]=function(a,b){var c=function(){var a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("button");a.style.position="fixed";a.style.zIndex="99999";a.style.top="0";a.style.left="0";a.style.width="1px";a.style.height="1px";a.style.overflow="hidden";a.style.visibility="hidden";b.style.margin="10% auto 0";b.style.width="215px";b.style.borderRadius="8px";b.style.backgroundColor="#f8f8f8";b.style.border="8px solid rgb(160, 160, 160)";
var g=this,l=function(){g.hide();g.closeCb&&g.closeCb.call()};c.appendChild(document.createTextNode("Close"));window.addEventListener?c.addEventListener("click",l,!1):c.attachEvent("onclick",l);a.appendChild(b);b.appendChild(c);this.screen=a;this.dialog=b;this.close=c;this.container=null;this.inserted=!1;this.embed=function(){};document.body?(document.body.appendChild(a),g.inserted=!0):(g=this,b=function(){document.body.appendChild(a);g.inserted=!0;g.embed()},window.addEventListener?window.addEventListener("load",
b,!1):window.attachEvent("onload",b))};c.prototype={insert:function(a,b){if(this.container){if(this.container==a)return;this.dialog.removeChild(this.container)}this.container=a;this.dialog.insertBefore(a,this.close);this.embed=b||this.embed();this.inserted&&this.embed()},show:function(a){this.closeCb=a;this.screen.style.width="100%";this.screen.style.height="auto";this.screen.style.visibility="visible";a=this.dialog.style.width.replace("px","")|0;var b=window.innerHeight||document.documentElement.clientHeight;
this.dialog.style.marginLeft=(((window.innerWidth||document.documentElement.clientWidth)-a)/2|0)+"px";this.dialog.style.marginTop=(0.1*b|0)+"px"},hide:function(){this.screen.style.width="1px";this.screen.style.height="1px";this.screen.style.visibility="hidden"}};b.Dialog=c};u["lib/twilio/eventemitter.js"]=function(a,b){function c(a,b,c){b=b||[];if(0==b.length)return-1;if(!c&&b.indexOf)return b.indexOf(a);for(c=0;c<b.length;c++)if(b[c]===a)return c;return-1}var d={addListener:function(b,c){if("function"!=
typeof c)throw new (a("twilio/util").Exception)("Listener must be a function, not "+typeof c);this.handlers[b]=this.handlers[b]||[];this.handlers[b].push(c);this.log('Registered listener for event type "'+b+'"');return this},hasListener:function(a,b){return-1!=c(b,this.handlers[a])},removeListener:function(a,b){var d=c(b,this.handlers[a]);-1<d&&(this.handlers[a].splice(d,1),this.log('Removed listener for event type "'+a+'"'));return this},fire:function(){var a=Array.prototype.slice.call(arguments,
0),b=a.shift(),c=this.handlers[b]||[];this.log('Invoke listeners for event type "'+b+'"');for(b=0;b<c.length;b++)c[b].apply(this,a)}};b.mixinEventEmitter=function(a){a.handlers=a.handlers||{};a.log=a.log||function(){};for(var b in d)a[b]||(a[b]=function(a,b){return function(){var c=Array.prototype.slice.call(arguments,0);return d[b].apply(a,c)}}(a,b))}};u["lib/twilio/eventstream.js"]=function(a,b){function c(a,b){if(!a.fire||!a.addListener)throw new g.Exception("Object is not event savvy");return function(){var c=
Array.prototype.slice.call(arguments,0);if("function"==typeof c[0])return a.addListener(b,c[0]);c.unshift(b);return a.fire.apply(a,c)}}function d(a,b){if(!(this instanceof d))return new d(a,b);var l={logPrefix:"[EventStream]",scheme:"wss",host:"stream.twilio.com",reconnect:!0,url:null,flashTimeout:5E3,filters:{},debug:!1};b=b||{};for(var g in l)g in b||(b[g]=l[g]);this.options=b;this.token=a||"";this.handlers={};this.status="offline";p.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;
this.heartbeat=new m({interval:15});this._connect();f.mixinEventEmitter(this);l="incoming ready offline sms call twiml error".split(" ");for(g=0;g<l.length;g++)this[l[g]]=c(this,l[g]);var h=this;this.addListener("publish",function(a){h.fire("twiml",a)})}var f=a("twilio/eventemitter"),p=a("twilio/log"),g=a("twilio/util"),l=a("twilio/factories"),m=a("twilio/heartbeat").Heartbeat;d.initializingFlash=!1;d.initializeFlash=function(a){d.initializingFlash||(d.initializingFlash=!0,window.WebSocket&&window.WebSocket.__initialize&&
(da=a.options.swfLocation,window.WebSocket.__initialize(),a.log("Waiting "+a.options.flashTimeout+"ms for flash to initialize"),window.setTimeout(function(){window.WebSocket.__flash||a.log("WebSocket did not initialize")},a.options.flashTimeout)))};d.toString=function(){return"[Twilio.EventStream class]"};d.prototype={toString:function(){return"[Twilio.EventStream instance]"},destroy:function(){this.socket.close();this.options.reconnect=!1;return this},publish:function(a,b){this.socket.send(JSON.stringify({"rt.message":"publish",
"rt.subchannel":b,"rt.payload":a}))},_connect:function(){var a=this,b=this._extractUrl();b?(this.log("Attempting to connect to "+b+"..."),this.socket=l.WebSocket(b),this.socket.onopen=function(){a.log("Socket opened... sending ready signal");a.socket.send(JSON.stringify({"rt.message":"listen","rt.token":a.token}))},this.socket.onerror=function(b){b.data?a.fire("error",{message:b.data.message||"",code:b.data.code||""}):a.log("Received message event:",b)},this.socket.onmessage=function(b){a.heartbeat.beat();
if("\n"!=b.data){b="string"!=typeof b.data?"":b.data.trim?b.data.trim():b.data.replace(/^\s+|\s+$/g,"");b=0==b.length?[]:b.split("\n");for(var c=0;c<b.length;c++){var d=JSON.parse(b[c]);if("ready"==d["rt.message"])a.status="ready",a.fire("ready",a);else{var f=d["rt.message"]||d.EventType;"error"==f&&/^4/.test(d.code)&&(a.options.reconnect=!1);"incoming"!=f&&a.fire("incoming",d);a.fire(f,d)}}}},this.socket.onclose=function(){a.log("Gone offline");a.status="offline";a.fire("offline",a)},this.heartbeat.onsleep=
function(){a.socket&&a.socket.close();a._tryReconnect(5E3)}):this.log("Nothing to do")},reconnect:function(a){this.socket&&this.socket.close();this.token=a;this.options.reconnect=!0;this._tryReconnect()},_extractUrl:function(){if(this.options.url)return this.options.url;var a=g.objectize(this.token).scope;if(!("stream:subscribe"in a))return null;var a=a["stream:subscribe"],a=a.params&&a.params.path?a.params.path:"/",b=this.options.filters;b.AccessToken=this.token;return this.options.scheme+"://"+
this.options.host+a+"?"+g.urlencode(b,!0)},_tryReconnect:function(a){(new Date).getTime();if(this.options.reconnect&&null!=this._extractUrl()){a=a||5E3;this._connect();var b,c=this;b=function(){c._tryReconnect(2*a)};var d=this;window.setTimeout(function(){2==d.socket.readyState&&window.setTimeout(b,a)},5E3)}}};var h=d,e=[],y=function(a){if(h.instance)return a();e.push(a)},n={instance:null,status:"offline",setup:function(a,b){h.instance=new h(a,b);for(var c=0;c<e.length;c++)e[c]();h.ready(function(){h.status=
"ready"});h.offline(function(){h.status="offline"});return h},incoming:function(a){y(function(){h.instance.incoming(a)});return h},ready:function(a){y(function(){h.instance.ready(a)});return h},offline:function(a){y(function(){h.instance.offline(a)});return h},sms:function(a){y(function(){h.instance.sms(a)});return h},call:function(a){y(function(){h.instance.call(a)});return h},twiml:function(a){y(function(){h.instance.twiml(a)});return h},error:function(a){y(function(){h.instance.error(a)});return h}},
B;for(B in n)h[B]=n[B];d=h;b.EventStream=d};u["lib/twilio/factories.js"]=function(a,b){function c(a,b){var c=b.length;if(0===c)return new a;if(1===c)return new a(b[0]);if(2===c)return new a(b[0],b[1]);if(3===c)return new a(b[0],b[1],b[2]);if(4===c)return new a(b[0],b[1],b[2],b[3])}function d(b,d,m){var h=b+"/"+d;m&&(p[h]=m);return function(){var m;m=f[h]||(p[h]?p[h]():a(b)[d]);var e=arguments;if(m.apply){var n=function(){};n.prototype=m.prototype;e=Array.prototype.slice.call(e,0);n=new n;m=m.apply(n,
e);m="object"===typeof m?m:n}else m=c(m,e);return m}}var f={},p={};b.registerClass=function(a,b,c){f[a+"/"+b]=c};b.getClass=function(a,b){var c=a+"/"+b;return f[c]||(p[c]?p[c]():void 0)};b.Presence=d("twilio/presence","Presence");b.Device=d("twilio/device","Device");b.Dialog=d("twilio/dialog","Dialog");b.Connection=d("twilio/connection","Connection");b.EventStream=d("twilio/eventstream","EventStream");b.SoundCache=d("twilio/soundcache","SoundCache");b.PeerConnection=d("twilio/rtc","PeerConnection");
b.MediaStream=d("vendor/swfobject","swfobject",function(){return C});b.Sound=d("vendor/sound/sound","Sound",function(){return Twilio.Sound});b.WebSocket=d("vendor/web-socket-js/websocket","WebSocket",function(){return WebSocket});b.MediaStream=d("vendor/mediastream/mediastream","MediaStream",function(){return Twilio.MediaStream})};u["lib/twilio/heartbeat.js"]=function(a,b){function c(a){if(!(this instanceof c))return new c(a);a=a||{};var b=function(){},b={interval:10,now:function(){return(new Date).getTime()},
repeat:function(a,b){return setInterval(a,b)},stop:function(a,b){return clearInterval(a,b)},onsleep:b,onwakeup:b},p;for(p in b)p in a||(a[p]=b[p]);this.interval=a.interval;this.lastbeat=0;this.pintvl=null;this.onsleep=a.onsleep;this.onwakeup=a.onwakeup;this.repeat=a.repeat;this.stop=a.stop;this.now=a.now}c.toString=function(){return"[Twilio.Heartbeat class]"};c.prototype={toString:function(){return"[Twilio.Heartbeat instance]"},beat:function(){this.lastbeat=this.now();if(this.sleeping()){if(this.onwakeup)this.onwakeup();
var a=this;this.pintvl=this.repeat.call(null,function(){a.check()},1E3*this.interval)}},check:function(){var a=this.now()-this.lastbeat;if(!this.sleeping()&&a>=1E3*this.interval){if(this.onsleep)this.onsleep();this.stop.call(null,this.pintvl);this.pintvl=null}},sleeping:function(){return null==this.pintvl}};b.Heartbeat=c};u["lib/twilio/log.js"]=function(a,b){b.mixinLog=function(a,b){function f(){if(f.enabled)for(var a=f.prefix?f.prefix+" ":"",b=0;b<arguments.length;b++){var c=arguments[b];f.handler("string"==
typeof c?a+c:c)}}f.enabled=!0;f.prefix=b||"";f.defaultHandler=function(a){window.console&&console.log(a)};f.handler=f.defaultHandler;a.log=f}};u["lib/twilio/options.js"]=function(a,b){var c=function(a,b){if(!(this instanceof c))return new c(a);this.__dict__={};a=a||{};b=b||{};for(var g in a)this[g]=d(this.__dict__,g),this[g](a[g]);for(g in b)this[g](b[g])},d=function(a,b){return function(c){return"undefined"==typeof c?a[b]:a[b]=c}};b.Options=c};u["lib/twilio/presence.js"]=function(a,b){var c=a("twilio/util").Set,
d=a("twilio/util").bind,f=a("twilio/options").Options,p=a("twilio/state"),g=function(a,b,h,g){this.roster=new c;this.handlers=[];this.clientName=a;this.options=new f({autoStart:!1,interval:300,variation:0.2,clearTimeout:function(a){return clearTimeout(a)},setTimeout:function(a,b){return setTimeout(a,b)}},g);this._boundPresence=d(this.handlePresence,this);this._boundRoster=d(this.handleRoster,this);b.addListener("offline",d(this.handleOffline,this));this.attach(h);this._boundHeartbeat=d(this.heartbeat,
this,h,{ttl:2*this.options.interval(),availability:"available",keepalive:!0});a=new p.StateM({stop:"start",start:"stop"},this);this.start=a.doStart;this.stop=a.doStop;this.options.autoStart()&&this.start()};g.prototype.enterStart=function(a,b){b={tid:null};var c=this;(function y(){var a;a=c.options.interval();var d=c.options.variation();a+=a*(2*Math.random()+-1)*d;b.tid=c.options.setTimeout()(function(){c._boundHeartbeat();y()},1E3*a)})();return b};g.prototype.enterStop=function(a,b){this.options.clearTimeout()(b.tid)};
g.prototype.heartbeat=function(a,b){a.publish(b,"presence")};g.prototype.attach=function(a){a.addListener("presence",this._boundPresence);a.addListener("roster",this._boundRoster)};g.prototype.detach=function(a){a.removeListener("presence",this._boundPresence);a.removeListener("roster",this._boundRoster)};g.prototype.removeFromRoster=function(a){this.roster.del(a);this.invoke(a,!1)};g.prototype.addToRoster=function(a){this.roster.put(a);this.invoke(a,!0)};g.prototype.handleOffline=function(){var a=
d(this.removeFromRoster,this);this.roster.map(a)};g.prototype.handlePresence=function(a){this[a.Available?"addToRoster":"removeFromRoster"](a.From)};g.prototype.handleRoster=function(a){for(var b=0;b<a.Roster.length;b++)this.addToRoster(a.Roster[b])};g.prototype.invoke=function(a,b){if(a!==this.clientName)for(var c={from:a,available:b},d=0;d<this.handlers.length;d++)this.handlers[d](c)};b.Presence=g};u["lib/twilio/rtc.js"]=function(a,b){var c=a("twilio/factories"),d=a("twilio/util"),f=function(a,
b){var c=function(){};this.onclose=this.onerror=this.onopen=c;this.stream=this.sock=this.version=null;this._uri="wss://"+b+"/signal";this.video=document.createElement("video");this.video.autoplay="autoplay";this.sendHangup=!0};f.prototype={uri:function(){return this._uri},openHelper:function(a){a()},_setupPeerConnection:function(){var a=f.protocol;a.create();a.pc.addStream(this.stream);var b=this;a.pc.onaddstream=function(a){b.video.src=webkitURL.createObjectURL(a.stream)};a.createOffer({audio:!0});
return a},_setupChannel:function(a,b,f,g,p,n){var e=c.WebSocket(a),r=this;e.onopen=function(){r.version.pc.onopen=r.onopen;e.send(JSON.stringify({type:"OFFER",sdp:r.version.getSDP(),fmt:r.fmt?r.fmt:{pt:104,name:"ISAC/32000"},twilio:{appsid:b?d.objectize(b).iss:null,token:b,bridgeToken:f,params:g,extras:[p,n]}}))};e.onmessage=function(a){a=JSON.parse(a.data);if("ANSWER"===a.type)r.version.processAnswer(a.sdp);else if("CANDIDATE"===a.type)r.version.processCandidate(a.candidate,a.label);else if("HANGUP"===
a.type){if(a.error)r.onerror({info:{code:a.error.code,message:a.error}});r.sendHangup=!1;r.close()}};e.onclose=function(){r.sock&&r.close()};return e},open:function(a,b,c,d,g,n){if(!this.sock){var p=this;f.getUserMedia({audio:!0},function(f){p.stream=f;p.version=p._setupPeerConnection();p.sock=p._setupChannel(a,b,c,d,g,n)})}},exec:function(a){var b=[].slice.call(arguments,1);if("sendDTMF"===a){var c=b[0];c&&c.length&&this.sock&&this.sock.send(JSON.stringify({type:"DTMF",dtmf:b[0]}))}},close:function(){this.version.pc&&
(this.version.pc.close(),this.version.pc=null);this.sock&&(this.sendHangup&&this.sock.send(JSON.stringify({type:"HANGUP"})),this.sock.close(),this.sock=null);this.stream&&(this.stream.stop(),this.stream=null);this.video.src="";this.onclose()},play:function(){},publish:function(){},attachAudio:function(){this.stream&&(this.stream.audioTracks[0].enabled=!0)},detachAudio:function(){this.stream&&(this.stream.audioTracks[0].enabled=!1)}};f.getUserMedia=function(a,b){"undefined"!=typeof navigator&&navigator.webkitGetUserMedia(a,
b)};var p=function(){};p.prototype.create=function(){this.pc=new webkitPeerConnection00(null,function(){});var a=this;this.pc.onerror=function(b){a.onerror({info:{message:b.toString()}})}};p.prototype.createOffer=function(a){this.pc.setLocalDescription(this.pc.SDP_OFFER,this.pc.createOffer(a));this.pc.startIce()};p.prototype.processAnswer=function(a){this.pc.setRemoteDescription(this.pc.SDP_ANSWER,new SessionDescription(a))};p.prototype.getSDP=function(){return this.pc.localDescription.toSdp()};p.prototype.processCandidate=
function(a,b){this.pc.processIceMessage(new IceCandidate(b,a))};p.test=function(){return"object"==typeof navigator&&navigator.webkitGetUserMedia&&"function"==typeof webkitPeerConnection00};var g=function(){};g.prototype.create=function(){this.pc=new webkitRTCPeerConnection({iceServers:[]})};g.prototype.createOffer=function(a){var b=this,c=function(a){if("undefined"===typeof a)return null;nc={mandatory:{}};"undefined"!==typeof a.audio&&(nc.mandatory.OfferToReceiveAudio=a.audio);"undefined"!==typeof a.video&&
(nc.mandatory.OfferToReceiveVideo=a.video);return nc},d=function(a){b.pc.setLocalDescription(new RTCSessionDescription(a))},f=function(){};try{this.pc.createOffer(d,f,a)}catch(g){this.pc.createOffer(d,f,c(a))}};g.prototype.getSDP=function(){return this.pc.localDescription.sdp};g.prototype.processAnswer=function(a){this.pc.setRemoteDescription(new RTCSessionDescription({sdp:a,type:"answer"}))};g.prototype.processCandidate=function(a){return this.pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:0,
candidate:a}))};g.test=function(){return"object"==typeof navigator&&navigator.webkitGetUserMedia&&"function"==typeof webkitRTCPeerConnection};p=p.test()?new p:g.test()?new g:void 0;f.protocol=p;f.enabled=!!f.protocol;b.PeerConnection=f;b.enabled=function(a){"undefined"!==typeof a&&(f.enabled=a);return f.enabled}};u["lib/twilio/soundcache.js"]=function(a,b){function c(a,b){return function(){var c=Array.prototype.slice(arguments);b.apply(a,c)}}function d(){if(!(this instanceof d))return new d;this.cache=
{}}var f=null,p=[],g=function(){var a=p.shift();if(a){var b=a[0],d=a[1]||0,a=a[2]||0;b in this.cache&&this.play(b);f=setTimeout(c(this,g),d+a)}else f=null};d.prototype={add:function(a,b,c){c=c||{};if(!(c instanceof Object))throw new TypeError("Bad envelope type; expected Object");b instanceof Array||(b=[b]);this.cache[a]={starttime:null,sounds:b,envelope:c}},play:function(a,b,c){b=b||0;c=c||1;if(a in this.cache){a=this.cache[a];for(var d=0;d<a.sounds.length;d++)a.sounds[d].play(b,c);a.starttime=(new Date).getTime()}},
stop:function(a){if(a in this.cache){var b=this.cache[a];a=b.envelope.release||0;var c=function(){for(var a=0;a<b.sounds.length;a++)b.sounds[a].stop()},d=(new Date).getTime(),d=Math.max(0,a-(d-b.starttime));0==a?c():setTimeout(c,d)}},envelope:function(a,b){if(a in this.cache){var c=this.cache[a],d;for(d in b)c.envelope[d]=b[d]}},playseq:function(a){for(var b=0;b<a.length;b++)p.push(a[b]);null==f&&(f=setTimeout(c(this,g),0))}};b.SoundCache=d};u["lib/twilio/state.js"]=function(a,b){var c,d,f,p,g={}.hasOwnProperty,
e=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},m=[].slice;p=function(a){return a.substr(0,1).toUpperCase()+a.slice(1)};f=function(a){var b,d,f;f=[];for(b in a)d=a[b],f.push(new c(b,d));return f};var h=function(){h.__super__.constructor.apply(this,arguments)},j=h,k=Error,n=function(){this.constructor=j},B;for(B in k)g.call(k,B)&&(j[B]=k[B]);n.prototype=k.prototype;j.prototype=new n;j.__super__=k.prototype;d=h;c=function(a,b,c){this.froms=a;
this.to=b;this.name=c;this.froms instanceof Array||(this.froms=[this.froms]);this.name=this.name||"do"+p(this.to)};g=function(a,b,c){var d;this.ctx=null!=b?b:this;this.stateData=null!=c?c:[];b=f(a);if(0===b.length)throw Error("Must initialize with at least one transition");this.state=b[0].froms[0];this.stateData instanceof Array||(this.stateData=[this.stateData]);c=0;for(d=b.length;c<d;c++)a=b[c],this.makeEvent(a)};g.prototype.makeEvent=function(a){var b=this;return this[a.name]=function(){var c;
if(c=b.state,0>e.call(a.froms,c))throw new d("Not a valid transition");b.stateData=b.invoke.apply(b,["leave",b.state,a].concat(m.call(b.stateData)));b.stateData=b.invoke.apply(b,["enter",a.to,a].concat(m.call(b.stateData)));return b.state=a.to}};g.prototype.invoke=function(){var a,b,c,d,f;b=arguments[0];c=arguments[1];d=arguments[2];a=4<=arguments.length?m.call(arguments,3):[];b+=p(c);return this.ctx[b]?(a=(f=this.ctx)[b].apply(f,[d].concat(m.call(a))),"undefined"===typeof a&&(a=[]),a instanceof Array?
a:[a]):a};b.TransitionError=d;b.Transition=c;b.StateM=g};u["lib/twilio/util.js"]=function(a,b){function c(a){if(!(this instanceof c))return new c(a);this.message=a}function d(a){return function(){var b=Array.prototype.slice.call(arguments,0);a.memo=a.memo||{};return a.memo[b]?a.memo[b]:a.memo[b]=a.apply(null,b)}}function f(a){a=a.split(".");if(3!=a.length)throw new c("Wrong number of segments");return h(a[1])}function p(a){if(""==a)return{};if(-1==a.indexOf("&")&&-1==a.indexOf("="))return a;a=a.split("&");
for(var b={},c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]=p(decodeURIComponent(d[1]))}return b}function g(a){try{return btoa(a)}catch(b){try{return(new Buffer(a)).toString("base64")}catch(c){return Twilio._phpjs_btoa(a)}}}function e(a){try{return atob(a)}catch(b){try{return(new Buffer(a,"base64")).toString("ascii")}catch(c){return Twilio._phpjs_atob(a)}}}function m(a){var b=[],c;for(c in a){var d="object"==typeof a[c]?m(a[c]):a[c];b.push(encodeURIComponent(c)+"="+encodeURIComponent(d))}return b.join("&")}
c.prototype.toString=function(){return"Twilio.Exception: "+this.message};var h=d(function(a){var b=a.length%4;0<b&&(a+=Array(4-b+1).join("="));a=a.replace(/-/g,"+").replace(/_/g,"/");a=e(a);return JSON.parse(a)}),j=d(function(a){a=f(a);for(var b=0===a.scope.length?[]:a.scope.split(" "),d={},g=0;g<b.length;g++){var e;e=b[g].match(/^scope:(\w+):(\w+)\??(.*)$/);if(!(e&&4==e.length))throw new c("Bad scope URI");e={service:e[1],privilege:e[2],params:p(e[3])};d[e.service+":"+e.privilege]=e}a.scope=d;return a}),
k=function(){this.set={}};k.prototype.clear=function(){this.set={}};k.prototype.put=function(a){return this.set[a]=k.DUMMY};k.prototype.del=function(a){return delete this.set[a]};k.prototype.map=function(a,b){var c=[],d;for(d in this.set)c.push(a.call(b,d));return c};k.DUMMY={};b.encodescope=function(a,b,c){a=["scope",a,b].join(":");b=!0;for(var d in c){b=!1;break}return b?a:a+"?"+m(c)};b.dummyToken=function(a){var b={iss:"AC1111111111111111111111111111111",exp:14E8},c;for(c in b)a[c]=a[c]||b[c];
a=g(JSON.stringify(a));a=a.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");return["*",a,"*"].join(".")};b.Exception=c;b.decode=f;b.btoa=g;b.atob=e;b.objectize=j;b.urlencode=function(a,b){var c=[];b=b||!1;for(var d in a)if(b&&a[d]instanceof Array)for(var f in a[d]){var g=a[d][f];c.push(encodeURIComponent(d)+"="+encodeURIComponent(g))}else g=a[d],c.push(encodeURIComponent(d)+"="+encodeURIComponent(g));return c.join("&")};b.Set=k;b.bind=function(a,b){var c=Array.prototype.slice.call(arguments,
2);return function(){var d=Array.prototype.slice.call(arguments);return a.apply(b,c.concat(d))}};b.getSystemInfo=function(){var b=a("twilio/factories").getClass("vendor/swfobject","swfobject"),c="undefined"!=typeof navigator?navigator:{};return{p:"browser",v:"undefined"!=typeof VERSION?VERSION:"1.0",browser:{userAgent:c.userAgent||"unknown",platform:c.platform||"unknown",plugin:"flash",flash:{v:b.getFlashPlayerVersion()}}}}};u["lib/twilio.js"]=function(a,b){b.Device=a("twilio/device").Device;b.EventStream=
a("twilio/eventstream").EventStream;b.Connection=a("twilio/connection").Connection;b.require=a};var z;if("undefined"!=typeof M)z=M;else{z=window.location.protocol||"http:";for(var x="//static.twilio.com/libs/twiliojs/1.0/",W=document.getElementsByTagName("script"),ea=/(\w+:)?(\/\/.*)(twilio.min.js|twilio.js)/,H=0;H<W.length;H++){var F=W[H].src.match(ea);if(F){z=F[1]||z;x=F[2];break}}z+=x}var M=z,da=M+"WebSocket.swf";window&&(window.WEB_SOCKET_SWF_LOCATION=da);this.JSON||(JSON=function(){function a(a){return 10>
a?"0"+a:a}function b(a,f){var e,g,l,m;e=/["\\\x00-\x1f\x7f-\x9f]/g;var h;switch(typeof a){case "string":return e.test(a)?'"'+a.replace(e,function(a){var b=c[a];if(b)return b;b=a.charCodeAt();return"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16)})+'"':'"'+a+'"';case "number":return isFinite(a)?String(a):"null";case "boolean":case "null":return String(a);case "object":if(!a)return"null";if("function"===typeof a.toJSON)return b(a.toJSON());e=[];if("number"===typeof a.length&&!a.propertyIsEnumerable("length")){m=
a.length;for(g=0;g<m;g+=1)e.push(b(a[g],f)||"null");return"["+e.join(",")+"]"}if(f){m=f.length;for(g=0;g<m;g+=1)l=f[g],"string"===typeof l&&(h=b(a[l],f))&&e.push(b(l)+":"+h)}else for(l in a)"string"===typeof l&&(h=b(a[l],f))&&e.push(b(l)+":"+h);return"{"+e.join(",")+"}"}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"};var c={"\b":"\\b","\t":"\\t",
"\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:b,parse:function(a,b){function c(a,d){var g,e;if(d&&"object"===typeof d)for(g in d)Object.prototype.hasOwnProperty.apply(d,[g])&&(e=c(g,d[g]),void 0!==e&&(d[g]=e));return b(a,d)}var g;if(/^[\],:{}\s]*$/.test(a.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return g=eval("("+a+")"),"function"===typeof b?c("",g):g;throw new SyntaxError("parseJSON");
}}}());var C,S=function(){if(!N){try{var a=q.getElementsByTagName("body")[0].appendChild(q.createElement("span"));a.parentNode.removeChild(a)}catch(b){return}N=!0;for(var a=X.length,c=0;c<a;c++)X[c]()}},pa=function(a){N?a():X[X.length]=a};z=function(a){if(typeof D.addEventListener!=t)D.addEventListener("load",a,!1);else if(typeof q.addEventListener!=t)q.addEventListener("load",a,!1);else if(typeof D.attachEvent!=t){var b=D;b.attachEvent("onload",a);T[T.length]=[b,"onload",a]}else if("function"==typeof D.onload){var c=
D.onload;D.onload=function(){c();a()}}else D.onload=a};var ia=function(){var a=L.length;if(0<a)for(var b=0;b<a;b++){var c=L[b].id,d=L[b].callbackFn,f={success:!1,id:c};if(0<j.pv[0]){var e=G(c);if(e)if(Y(L[b].swfVersion)&&!(j.wk&&312>j.wk))O(c,!0),d&&(f.success=!0,f.ref=fa(c),d(f));else if(L[b].expressInstall&&ga()){f={};f.data=L[b].expressInstall;f.width=e.getAttribute("width")||"0";f.height=e.getAttribute("height")||"0";e.getAttribute("class")&&(f.styleclass=e.getAttribute("class"));e.getAttribute("align")&&
(f.align=e.getAttribute("align"));for(var g={},e=e.getElementsByTagName("param"),l=e.length,m=0;m<l;m++)"movie"!=e[m].getAttribute("name").toLowerCase()&&(g[e[m].getAttribute("name")]=e[m].getAttribute("value"));ha(f,g,c,d)}else Aa(e),d&&d(f)}else if(O(c,!0),d){if((c=fa(c))&&typeof c.SetVariable!=t)f.success=!0,f.ref=c;d(f)}}},fa=function(a){var b=null;if((a=G(a))&&"OBJECT"==a.nodeName)typeof a.SetVariable!=t?b=a:(a=a.getElementsByTagName(I)[0])&&(b=a);return b},ga=function(){return!Z&&Y("6.0.65")&&
(j.win||j.mac)&&!(j.wk&&312>j.wk)},ha=function(a,b,c,d){Z=!0;ja=d||null;qa={success:!1,id:c};var f=G(c);if(f){"OBJECT"==f.nodeName?(U=ka(f),$=null):(U=f,$=c);a.id=ra;if(typeof a.width==t||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if(typeof a.height==t||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";q.title=q.title.slice(0,47)+" - Flash Player Installation";d=j.ie&&j.win?"ActiveX":"PlugIn";d="MMredirectURL="+D.location.toString().replace(/&/g,"%26")+"&MMplayerType="+
d+"&MMdoctitle="+q.title;b.flashvars=typeof b.flashvars!=t?b.flashvars+("&"+d):d;j.ie&&(j.win&&4!=f.readyState)&&(d=q.createElement("div"),c+="SWFObjectNew",d.setAttribute("id",c),f.parentNode.insertBefore(d,f),f.style.display="none",function(){4==f.readyState?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)}());la(a,b,c)}},Aa=function(a){if(j.ie&&j.win&&4!=a.readyState){var b=q.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(ka(a),b);a.style.display="none";
(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(ka(a),a)},ka=function(a){var b=q.createElement("div");if(j.win&&j.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(I)[0])if(a=a.childNodes)for(var c=a.length,d=0;d<c;d++)!(1==a[d].nodeType&&"PARAM"==a[d].nodeName)&&8!=a[d].nodeType&&b.appendChild(a[d].cloneNode(!0));return b},la=function(a,b,c){var d,f=G(c);if(j.wk&&312>j.wk)return d;if(f)if(typeof a.id==t&&(a.id=c),
j.ie&&j.win){var e="",g;for(g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?e+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(e+=" "+g+'="'+a[g]+'"'));g="";for(var l in b)b[l]!=Object.prototype[l]&&(g+='<param name="'+l+'" value="'+b[l]+'" />');f.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+e+">"+g+"</object>";aa[aa.length]=a.id;d=G(a.id)}else{l=q.createElement(I);l.setAttribute("type",ba);for(var m in a)a[m]!=Object.prototype[m]&&
("styleclass"==m.toLowerCase()?l.setAttribute("class",a[m]):"classid"!=m.toLowerCase()&&l.setAttribute(m,a[m]));for(e in b)b[e]!=Object.prototype[e]&&"movie"!=e.toLowerCase()&&(a=l,g=e,m=b[e],c=q.createElement("param"),c.setAttribute("name",g),c.setAttribute("value",m),a.appendChild(c));f.parentNode.replaceChild(l,f);d=l}return d},sa=function(a){var b=G(a);b&&"OBJECT"==b.nodeName&&(j.ie&&j.win?(b.style.display="none",function(){if(4==b.readyState){var c=G(a);if(c){for(var d in c)"function"==typeof c[d]&&
(c[d]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))},G=function(a){var b=null;try{b=q.getElementById(a)}catch(c){}return b},Y=function(a){var b=j.pv;a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1},ta=function(a,b,c,d){if(!j.ie||!j.mac){var f=q.getElementsByTagName("head")[0];if(f){c=c&&"string"==typeof c?c:"screen";
d&&(ma=J=null);if(!J||ma!=c)d=q.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("media",c),J=f.appendChild(d),j.ie&&(j.win&&typeof q.styleSheets!=t&&0<q.styleSheets.length)&&(J=q.styleSheets[q.styleSheets.length-1]),ma=c;j.ie&&j.win?J&&typeof J.addRule==I&&J.addRule(a,b):J&&typeof q.createTextNode!=t&&J.appendChild(q.createTextNode(a+" {"+b+"}"))}}},O=function(a,b){if(ua){var c=b?"visible":"hidden";N&&G(a)?G(a).style.visibility=c:ta("#"+a,"visibility:"+c)}},va=function(a){return null!=
/[\\\"<>\.;]/.exec(a)&&typeof encodeURIComponent!=t?encodeURIComponent(a):a},t="undefined",I="object",ba="application/x-shockwave-flash",ra="SWFObjectExprInst",D=window,q=document,x=navigator,wa=!1,X=[function(){if(wa){var a=q.getElementsByTagName("body")[0],b=q.createElement(I);b.setAttribute("type",ba);var c=a.appendChild(b);if(c){var d=0;(function(){if(typeof c.GetVariable!=t){var f=c.GetVariable("$version");f&&(f=f.split(" ")[1].split(","),j.pv=[parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],
10)])}else if(10>d){d++;setTimeout(arguments.callee,10);return}a.removeChild(b);c=null;ia()})()}else ia()}else ia()}],L=[],aa=[],T=[],U,$,ja,qa,N=!1,Z=!1,J,ma,ua=!0,j,W=typeof q.getElementById!=t&&typeof q.getElementsByTagName!=t&&typeof q.createElement!=t,F=x.userAgent.toLowerCase(),ea=(H=x.platform.toLowerCase())?/win/.test(H):/win/.test(F),H=H?/mac/.test(H):/mac/.test(F),F=/webkit/.test(F)?parseFloat(F.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,na=!+"\v1",V=[0,0,0],A=null;if(typeof x.plugins!=
t&&typeof x.plugins["Shockwave Flash"]==I){if((A=x.plugins["Shockwave Flash"].description)&&!(typeof x.mimeTypes!=t&&x.mimeTypes[ba]&&!x.mimeTypes[ba].enabledPlugin))wa=!0,na=!1,A=A.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),V[0]=parseInt(A.replace(/^(.*)\..*$/,"$1"),10),V[1]=parseInt(A.replace(/^.*\.(.*)\s.*$/,"$1"),10),V[2]=/[a-zA-Z]/.test(A)?parseInt(A.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}else if(typeof D.ActiveXObject!=t)try{var v=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(v&&(A=v.GetVariable("$version")))na=
!0,A=A.split(" ")[1].split(","),V=[parseInt(A[0],10),parseInt(A[1],10),parseInt(A[2],10)]}catch(Ea){}j={w3:W,pv:V,wk:F,ie:na,win:ea,mac:H};j.w3&&((typeof q.readyState!=t&&"complete"==q.readyState||typeof q.readyState==t&&(q.getElementsByTagName("body")[0]||q.body))&&S(),N||(typeof q.addEventListener!=t&&q.addEventListener("DOMContentLoaded",S,!1),j.ie&&j.win&&(q.attachEvent("onreadystatechange",function(){"complete"==q.readyState&&(q.detachEvent("onreadystatechange",arguments.callee),S())}),D==top&&
function(){if(!N){try{q.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}S()}}()),j.wk&&function(){N||(/loaded|complete/.test(q.readyState)?S():setTimeout(arguments.callee,0))}(),z(S)));j.ie&&j.win&&window.attachEvent("onunload",function(){for(var a=T.length,b=0;b<a;b++)T[b][0].detachEvent(T[b][1],T[b][2]);a=aa.length;for(b=0;b<a;b++)sa(aa[b]);for(var c in j)j[c]=null;j=null;for(var d in C)C[d]=null;C=null});C={registerObject:function(a,b,c,d){if(j.w3&&a&&b){var f={};
f.id=a;f.swfVersion=b;f.expressInstall=c;f.callbackFn=d;L[L.length]=f;O(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(j.w3)return fa(a)},embedSWF:function(a,b,c,d,f,e,g,l,m,h){var k={success:!1,id:b};j.w3&&!(j.wk&&312>j.wk)&&a&&b&&c&&d&&f?(O(b,!1),pa(function(){c+="";d+="";var j={};if(m&&typeof m===I)for(var n in m)j[n]=m[n];j.data=a;j.width=c;j.height=d;n={};if(l&&typeof l===I)for(var q in l)n[q]=l[q];if(g&&typeof g===I)for(var r in g)n.flashvars=typeof n.flashvars!=t?n.flashvars+
("&"+r+"="+g[r]):r+"="+g[r];if(Y(f))q=la(j,n,b),j.id==b&&O(b,!0),k.success=!0,k.ref=q;else{if(e&&ga()){j.data=e;ha(j,n,b,h);return}O(b,!0)}h&&h(k)})):h&&h(k)},switchOffAutoHideShow:function(){ua=!1},ua:j,getFlashPlayerVersion:function(){return{major:j.pv[0],minor:j.pv[1],release:j.pv[2]}},hasFlashPlayerVersion:Y,createSWF:function(a,b,c){if(j.w3)return la(a,b,c)},showExpressInstall:function(a,b,c,d){j.w3&&ga()&&ha(a,b,c,d)},removeSWF:function(a){j.w3&&sa(a)},createCSS:function(a,b,c,d){j.w3&&ta(a,
b,c,d)},addDomLoadEvent:pa,addLoadEvent:z,getQueryParamValue:function(a){var b=q.location.search||q.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return va(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return va(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(Z){var a=G(ra);a&&U&&(a.parentNode.replaceChild(U,a),$&&(O($,!0),j.ie&&j.win&&(U.style.display="block")),ja&&ja(qa));Z=!1}}};if(!window.WebSocket){var E=
window.console;if(!E||!E.log||!E.error)E={log:function(){},error:function(){}};C.hasFlashPlayerVersion("10.0.0")?("file:"==location.protocol&&E.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,b,c,d,f){var e=this;e.__id=WebSocket.__nextId++;WebSocket.__instances[e.__id]=e;e.readyState=WebSocket.CONNECTING;e.bufferedAmount=0;e.__events={};setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(e.__id,
a,b,c||null,d||0,f||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";a=WebSocket.__flash.send(this.__id,encodeURIComponent(a));if(0>a)return!0;this.bufferedAmount+=a;return!1},WebSocket.prototype.close=function(){this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING||(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=
function(a,b){a in this.__events||(this.__events[a]=[]);this.__events[a].push(b)},WebSocket.prototype.removeEventListener=function(a,b){if(a in this.__events)for(var c=this.__events[a],d=c.length-1;0<=d;--d)if(c[d]===b){c.splice(d,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var b=this.__events[a.type]||[],c=0;c<b.length;++c)b[c](a);(b=this["on"+a.type])&&b(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState);if("open"==a.type||"error"==
a.type)a=this.__createSimpleEvent(a.type);else if("close"==a.type)a=this.__createSimpleEvent("close");else if("message"==a.type)a=decodeURIComponent(a.message),a=this.__createMessageEvent("message",a);else throw"unknown event type: "+a.type;this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&window.Event){var b=document.createEvent("Event");b.initEvent(a,!1,!1);return b}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=
function(a,b){if(document.createEvent&&window.MessageEvent&&!window.opera){var c=document.createEvent("MessageEvent");c.initMessageEvent("message",!1,!1,b,null,null,window,null);return c}return{type:a,data:b,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},
WebSocket.__initialize=function(){if(!WebSocket.__flash)if(document.body)if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION){var a=document.createElement("div");a.id="webSocketContainer";a.style.position="absolute";WebSocket.__isFlashLite()?(a.style.left="0px",a.style.top="0px"):(a.style.left="-100px",a.style.top="-100px");var b=document.createElement("div");b.id="webSocketFlash";a.appendChild(b);document.body.appendChild(a);C.embedSWF(da,
"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(a){a.success||E.error("[WebSocket] swfobject.embedSWF failed")})}else E.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");else window.addEventListener?window.addEventListener("load",WebSocket.__initialize,!1):window.attachEvent("onload",WebSocket.__initialize)},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");
WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var a=WebSocket.__flash.receiveEvents(),b=0;b<a.length;++b)WebSocket.__instances[a[b].webSocketId].__handleEvent(a[b])}catch(c){E.error(c)}},0);return!0},WebSocket.__log=function(a){E.log(decodeURIComponent(a))},WebSocket.__error=function(a){E.error(decodeURIComponent(a))},
WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return!a||!a.enabledPlugin||!a.enabledPlugin.filename?!1:a.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||WebSocket.__initialize()):E.error("Flash Player >= 10.0.0 is required.")}v=window;v.Twilio=v.Twilio||{};
v.Twilio._phpjs_atob=function(a){var b,c,d,f,e,g=0,l=0;f="";var j=[];if(!a)return a;a+="";do b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(g++)),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(g++)),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(g++)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(g++)),d=b<<18|c<<12|f<<6|e,b=d>>16&255,c=d>>
8&255,d&=255,64==f?j[l++]=String.fromCharCode(b):64==e?j[l++]=String.fromCharCode(b,c):j[l++]=String.fromCharCode(b,c,d);while(g<a.length);f=j.join("");a=[];b=j=e=l=g=0;for(f+="";g<f.length;)e=f.charCodeAt(g),128>e?(a[l++]=String.fromCharCode(e),g++):191<e&&224>e?(j=f.charCodeAt(g+1),a[l++]=String.fromCharCode((e&31)<<6|j&63),g+=2):(j=f.charCodeAt(g+1),b=f.charCodeAt(g+2),a[l++]=String.fromCharCode((e&15)<<12|(j&63)<<6|b&63),g+=3);return f=a.join("")};v.Twilio._phpjs_btoa=function(a){var b,c,d,f,
e=0,g=0,j="",j=[];if(!a)return a;a+="";if(null===a||"undefined"===typeof a)a="";else{a+="";b="";c=d=f=0;f=a.length;for(var k=0;k<f;k++){var h=a.charCodeAt(k),q=null;128>h?d++:q=127<h&&2048>h?String.fromCharCode(h>>6|192)+String.fromCharCode(h&63|128):String.fromCharCode(h>>12|224)+String.fromCharCode(h>>6&63|128)+String.fromCharCode(h&63|128);null!==q&&(d>c&&(b+=a.slice(c,d)),b+=q,c=d=k+1)}d>c&&(b+=a.slice(c,f));a=b}do b=a.charCodeAt(e++),c=a.charCodeAt(e++),d=a.charCodeAt(e++),f=b<<16|c<<8|d,b=f>>
18&63,c=f>>12&63,d=f>>6&63,f&=63,j[g++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f);while(e<a.length);j=j.join("");switch(a.length%3){case 1:j=j.slice(0,-2)+"==";break;case 2:j=j.slice(0,-1)+"="}return j};var v=window[window.NS_BEEP]||
window,K=function(a){if(!(this instanceof K))return new K(a);if("number"!=typeof a||1>a)return null;this.channels=1;this.bitdepth=16;this.samplerate=a;this.sine=[];for(var b=2*Math.PI/parseFloat(a),c=0;c<a;c++)this.sine.push(Math.sin(c*b))},s={amplify:function(a){return function(b){return b*a}},ushort:function(a){return String.fromCharCode(255&a,255&a>>8)},ulong:function(a){return String.fromCharCode(255&a,255&a>>8,255&a>>16,255&a>>24)},gcd:function(a,b){for(;b;){var c=a;a=b;b=c%b}return a},lcm:function(a,
b){return Math.floor(a*b/s.gcd(a,b))},compose:function(a){return function(b){for(var c=0;c<a.length;c++)b=a[c](b);return b}},map:function(a,b){for(var c=[],d=0;d<b.length;d++)c.push(a.call(this,b[d]));return c},getattr:function(a){return function(b){return b[a]}},zip:function(){if(0==arguments.length)return[];for(var a=Array.prototype.slice.call(arguments),b=[],c=Math.min.apply(null,s.map(s.getattr("length"),a)),d=0;d<c;d++)b.push(s.map(s.getattr(d),a));return b},sum:function(a){return s.foldl(function(a,
c){return a+c},a)},bind:function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(a,c)}},foldl:function(a,b){if(1==b.length)return b[0];for(var c=a(b[0],b[1]),d=2;d<b.length;d++)c=a(c,b[d]);return c},mulmod:function(a,b,c){return a*b%c},range:function(a){for(var b=[],c=0;c<a;c++)b.push(c);return b}};K.prototype={generate:function(a){a=a instanceof Array?a:[a];var b=s.bind(this,s.map),c=b(function(a){return s.lcm(this.samplerate,a)/a},a),c=s.foldl(s.lcm,c),d=function(a){return function(b){return this.sine[s.mulmod(a,
b,this.samplerate)]}};return b(function(c){return s.sum(b(d(c),a))},s.range(c))},encode:function(a,b,c){a=a instanceof Array?a:[a];c=s.compose((c||[]).concat([s.ushort]));a=s.map(c,this.generate(a));c=Math.ceil(b*this.samplerate/a.length);a=Array(c+1).join(a.join("")).substr(0,2*this.samplerate*b);b=["fmt ",s.ulong(K.PCM_CHUNK_SIZE),s.ushort(K.LINEAR_QUANTIZATION),s.ushort(this.channels),s.ulong(this.samplerate),s.ulong(this.samplerate*this.channels*this.bitdepth/8),s.ushort(this.bitdepth/8),s.ushort(this.bitdepth)].join("");
a=["data",s.ulong(a.length*this.channels*this.bitdepth/8),a].join("");return[["RIFF",s.ulong(4+(8+b.length)+(8+a.length)),"WAVE"].join(""),b,a].join("")},play:function(a,b,c){c=c||[];a=btoa(this.encode(a,b,c));b=document.createElement("audio");b.src="data:audio/x-wav;base64,"+a;b.play()}};K.LINEAR_QUANTIZATION=1;K.PCM_CHUNK_SIZE=16;K.utils=s;v.Beep=K;var v=this.Twilio,k=function(){this.id=k.nextId++;k.items[this.id]=this;this.create()},Ba={create:function(){this.audio=document.createElement("audio");
this.playing=!1},buffer:function(){},play:function(a,b){if(!(this.playing||0>=b)){if(this.audio.currentTime!==a)try{if(this.audio.currentTime=a,this.audio.currentTime!==a)throw Error();}catch(c){var d=this.audio.src;this.audio.src="";this.audio.src=d}this.playing=!0;this.audio.play();var f=this;this.audio.addEventListener("ended",function g(){f.audio.removeEventListener("ended",g,!1);f.playing?(f.playing=!1,f.play(a,b-1)):f.playing=!1},!1)}},load:function(a){this.audio.src=a},stop:function(){this.playing=
!1},destroy:function(){this.audio.src="";delete this.audio}},Ca={create:function(){var a=this.id;k.queue(function(){k.flash.__create(a)})},buffer:function(a){var b=this.id;k.queue(function(){k.flash.__buffer(b,a)})},play:function(a,b){a=a||0;b=b||0;var c=this.id;k.queue(function(){k.flash.__play(c,a,b)})},load:function(a){var b=this.id;k.queue(function(){k.flash.__load(b,a)})},stop:function(){var a=this.id;k.queue(function(){k.flash.__stop(a)})},destroy:function(){var a=this.id;k.queue(function(){k.flash.__destroy(a);
delete k.items[a]})}},Da={create:function(){},buffer:function(){},play:function(){},load:function(){},stop:function(){},destroy:function(){}},xa={initializeFlash:function(a){a=a||{};a.swfLocation=a.swfLocation||"SoundMain.swf";a.domId=a.domId||"__soundFlash__";if(!k.flash)if(document.body){var b=document.createElement("div");b.id=a.domId;document.body.appendChild(b);k.flash=b;C.embedSWF(a.swfLocation,a.domId,"1","1","10.0.0",null,{namespace:"Twilio.Sound"},{hasPriority:!0,allowScriptAccess:"always"},
null,function(a){k.log("Embed "+(a.success?"succeeded":"failed"))})}else try{window.addEventListener("load",function(){k.initializeFlash(a)},!1)}catch(c){window.attachEvent("onload",function(){k.initializeFlash(a)})}},log:function(a,b,c){if(k.debug&&window.console&&(c=c||"log",console[c]("[Sound] "+a),"undefined"!=typeof b))console[c](b)},queue:function(a){k.initialized?a():k.tasks.push(a)}},ya={__onFlashInitialized:function(){k.initialized=!0;k.flash=document.getElementById(k.flash.id);setTimeout(function(){k.flash.__setDebug(k.debug);
k.log("Initialized and ready");for(var a=0;a<k.tasks.length;a++)k.tasks[a]()},0)},__onLog:function(a){k.log(a)}};k.nextId=0;k.debug=!1;k.tasks=[];k.items={};k.initialize=function(a){if(!a.forceFlash&&document.createElement("audio"))k.prototype=Ba;else if(C.hasFlashPlayerVersion("10.0.0")){k.prototype=Ca;for(var b in xa)k[b]=xa[b];for(b in ya)k[b]=ya[b];k.initializeFlash(a)}else k.prototype=Da,"undefined"!=typeof console&&console.error("WARNING: Audio sounds disabled. HTML5 audio support or Flash Player >= 10.0.0 is required")};
v.Sound=k;var v=this.Twilio,e=function(a,b){this.__id=e.__nextId++;var c=function(){};this.onclose=this.onerror=this.onopen=c;this._uri=(a?"rtmps":"rtmp")+"://"+b+"/chunder";e.__instances[this.__id]=this},za=function(a,b){if(document.body){var c=document.createElement("div");c.style.position="absolute";c.appendChild(a);document.body.appendChild(c);b()}else{c=function(){za(a,b)};try{window.addEventListener("load",c,!1)}catch(d){window.attachEvent("onload",c)}}};e.prototype={openHelper:function(a,b,
c,d,f){e.__queue(function(){var j=e.getMicrophones().length==c;b?(!j&&e.isMicMuted()&&d(),a()):j?a("No microphone is available"):e.isMicMuted()?f(function(){e.isMicMuted()?a("Access to microphone has been denied"):a()}):a()})},uri:function(){return this._uri},open:function(){var a=this,b=Array.prototype.slice.call(arguments);e.__queue(function(){e.__flash.open.apply(e.__flash,[a.__id].concat(b))})},exec:function(){var a=this,b=Array.prototype.slice.call(arguments);e.__queue(function(){e.__flash.exec.apply(e.__flash,
[a.__id].concat(b))})},close:function(){var a=this;e.__queue(function(){e.__flash.close(a.__id)})},play:function(){var a=this,b=Array.prototype.slice.call(arguments);e.__queue(function(){e.__flash.playStream.apply(e.__flash,[a.__id].concat(b))})},publish:function(a,b){var c=this;e.__queue(function(){e.__flash.publish(c.__id,a,b)})},attachAudio:function(a){var b=this;e.__queue(function(){e.__flash.attachAudio(b.__id,a)})},detachAudio:function(){var a=this;e.__queue(function(){e.__flash.detachAudio(a.__id)})},
__handleEvent:function(a){switch(a.type){case "gatewayError":case "securityError":case "asyncError":case "ioError":this.onerror.call(this,a);break;case "netStatus":this.__handleNetStatus(a)}},__handleNetStatus:function(a){e.log("Event info code: "+a.info.code);switch(a.info.code){case "NetConnection.Connect.Failed":case "NetConnection.Connect.Rejected":e.log("Connection failed or was rejected");this.onerror.call(this,a);break;case "NetConnection.Connect.Closed":e.log("Connection closed");this.onclose.call(this,
a);break;case "NetConnection.Connect.Success":e.log("Connection established");this.onopen.call(this);break;default:e.log("Unexpected event: "+a.info.code)}}};z={__queue:function(a){e.initialized?a():e.__tasks.push(a)},initialize:function(a){if(C.hasFlashPlayerVersion("10.0.0")){if(!e.__flash)if(a=a||{},a.swfLocation=a.swfLocation||"MediaStreamMain.swf",a.domId=a.domId||"__connectionFlash__",a.loader=a.loader||za,document.body){var b=document.createElement("div");b.id=a.domId;a.loader(b,function(){e.__flash=
b;var c={};"objectEnc"in a&&(c.objectEnc=a.objectEnc);c.namespace="Twilio.MediaStream";C.embedSWF(a.swfLocation,a.domId,"215","138","10.0.0",null,c,{hasPriority:!0,allowScriptAccess:"always"},null,function(a){e.log("Embed "+(a.success?"succeeded":"failed"))})})}else try{window.addEventListener("load",function(){e.initialize(a)},!1)}catch(c){window.attachEvent("onload",function(){e.initialize(a)})}}else window.console&&console.error("Flash Player >= 10.0.0 is required.")},setMicrophoneGain:function(a){e.__queue(function(){try{e.__flash.setMicrophoneGain(a)}catch(b){e.log(b)}})},
setMicrophone:function(a,b){e.__queue(function(){e.__flash.setMicrophone(a,b)})},getMicrophone:function(){return e.initialized?e.__flash.getMicrophone():null},getMicrophones:function(){return e.initialized?e.__flash.getMicrophones():[]},setUseEchoSuppression:function(a){e.__queue(function(){try{e.__flash.setUseEchoSupression(a)}catch(b){e.log(b)}})},setSilenceLevel:function(a,b){e.__queue(function(){try{e.__flash.setSilenceLevel(a,b)}catch(c){e.log(c)}})},showSettings:function(){e.__queue(function(){e.__flash.showSettings()})},
isMicMuted:function(){try{return e.__flash.isMicMuted()}catch(a){if(!(a instanceof TypeError))throw a;}},log:function(a,b,c){if(e.__debug&&window.console&&(c=c||"log",console[c]("[MediaStream] "+a),"undefined"!=typeof b))console[c](b)}};var x={__onFlashInitialized:function(){e.initialized=!0;e.__flash=document.getElementById(e.__flash.id);setTimeout(function(){e.__flash.setDebug(e.__debug);/Mac OS X.*Chrome\/2[34]/.test(navigator.userAgent)?e.setMicrophone(-1,!1):e.setMicrophone(-1,!0);var a=e.getMicrophone();
e.log(a?"Using "+a:"No mics available");e.setMicrophoneGain(75);for(a=0;a<e.__tasks.length;a++)e.__tasks[a].call()},0)},__onMediaStreamEvent:function(){setTimeout(function(){for(var a=e.__flash.dequeueEvents(),b=0;b<a.length;b++)try{e.log("Received event: "+a[b].type),e.__instances[a[b].mediaStreamId].__handleEvent(a[b])}catch(c){e.log("Error while processing "+a[b].type+": "+c.message,c,"error")}},0)},__onLog:function(a){"error"==a.level?e.log(a.message,void 0,"error"):e.log(a.message)}},w;for(w in z)e[w]=
z[w];for(w in x)e[w]=x[w];e.__nextId=0;e.__flash=null;e.__instances={};e.__tasks=[];e.__debug=!1;e.initialized=!1;e.AMF0=0;e.AMF3=3;v.MediaStream=e;w=document.createElement("audio");v=!0;try{v=!(w.canPlayType&&w.canPlayType("audio/mpeg").replace(/no/,""))}catch(Fa){}Twilio.Sound.initialize({swfLocation:M+"SoundMain.swf",forceFlash:v});var ca=Q("twilio/device").Device;ca.__afterSetup(function(a){if(!Q("twilio/rtc").enabled()){var b=Q("twilio/util").decode,c=Q("twilio/factories").getClass("vendor/mediastream/mediastream",
"MediaStream");c.initialize({objectEnc:c.AMF0,swfLocation:function(a,c){if(!a)return c;var e=c.match(/^(\w+):\/\/([^/]*)(.*)?/);if(!e)return c;var g=e[1],j=e[2],e=e[3];if(!/twilio.com$/.test(j.split(":")[0]))return c;var k=b(a).iss;return!k?c:g+"://"+k.toLowerCase()+"."+j+e}(a,M)+"MediaStreamMain.swf",loader:function(a,b){ca.dialog.insert(a,b)}})}});w=Q("twilio");w.Sound=Twilio.Sound;w.MediaStream=Twilio.MediaStream;w._phpjs_atob=Twilio._phpjs_atob;w._phpjs_btoa=Twilio._phpjs_btoa;return w}());
